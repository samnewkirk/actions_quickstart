name: RestAPI Comm
on:
  workflow_dispatch:
    inputs:
      azure_region:
        description: "The Azure Region" # eg: EastUs
        required: true
      business_unit:
        description: "The Business Unit requesting the resources."
        required: true
      deploy_resources:
        description: "Which resources to deploy" # eg: deploy_azure_ml=false,deploy_azure_open_ai=false,deploy_ai_search=false,deploy_computer_vision=false,deploy_document_intelligence=false
      environment:
        description: "The Environment to deploy to - Used for naming" # eg: Dev
        required: true
      project_name:
        description: "The name of the Project - used for naming"
        required: true
      user_email:
        description: "The email of the user requesting the deployment"
        required: true
      workflow_id:
        description: "The workflow id generated by the rest API"
        required: true

permissions:
  contents: write
env:
  DIRECTORY: "./mydir123"
  TEMPLATE: "./faketftemplate"
  TFVARS: "my.auto.tfvars"
jobs:
    setup:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4
            - id: create_folder
              name: Create Folder
              run: |
                echo "Creating Folder...."
                if [ ! -d "$DIRECTORY" ]; then mkdir "$DIRECTORY"; fi
                ls -al
            - id: copy_template
              name: Copy Template
              run: |
                echo "Copying Template...(overwrite)"
                cp -rf $TEMPLATE/* $DIRECTORY
            - id: Write_tfvars
              name: Write TfVars
              run: |
                cd $DIRECTORY
                touch "$TFVARS"
                echo "azure_region = \"${{ github.event.inputs.azure_region }}\"">>$TFVARS
                echo "${{ github.event.inputs.deploy_resources }}" | tr ',' '\n'>>$TFVARS
                echo "ad_user_email = \"${{ github.event.inputs.user_email }}\"">>$TFVARS

                cat $TFVARS

            - id: commit
              name: Commit
              run: |
                git config user.name github-actions
                git config user.email github-actions@github.com
                git add .
                git commit -m "generated"
                git push